import _ from "lodash";
import React from "react";
import classNames from "classnames";
import styles from "./ProgressBarShape.module.css";

import { ProgressBarBounds, ProgressSmallBar } from "./ProgressBarParts";
import { indicatorStore } from "@/stores/IndicatorStore.js";
import { observer } from "mobx-react-lite";

export const ProgressBarShape = observer(
    ({ bottomBoundFormatted, topBoundFormatted, dashboardSizeAlias, size }) => {
        const {
            progressBarKeys: { indicatorType },
            indicatorSize,
        } = indicatorStore;

        const renderBlock = (position) => {
            const barClassName = getClassNames(position);

            return (
                <div id="line" className={styles.Line}>
                    <div className={barClassName}>
                        <ProgressBarBounds
                            position={position}
                            side="left"
                            bound={bottomBoundFormatted}
                        />
                        <ProgressSmallBar
                            position={position}
                            size={size}
                            indicatorType={indicatorType}
                        />
                        <ProgressBarBounds
                            bound={topBoundFormatted}
                            side="right"
                            position={position}
                        />
                    </div>
                </div>
            );
        };

        const getClassNames = (position) => {
            const positionClass = _.upperFirst(position);

            const resultClass = classNames({
                [styles.Bar]: true,
                [styles[indicatorSize]]: true,
                [styles[positionClass]]: true,
                [styles.Clone]: position !== "middle",
                [styles[indicatorType]]: true,
            });

            const res = classNames({
                [styles["large"]]: true,
            });

            return resultClass;
        };

        const shapeClass = classNames(styles.MainBar, styles[indicatorType]);

        return (
            <div className={shapeClass}>
                {renderBlock("top")}
                {renderBlock("middle")}
                {renderBlock("bottom")}
            </div>
        );
    },
);
